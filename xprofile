#!sh

xhost +"SI:localuser:$USER" &

if [ ! "$DESKTOP_SESSION" ]; then
	bgcolor='#333333'
	bgimage='/usr/share/gnome-shell/theme/noise-texture.png'

	if have hsetroot; then
		if [ -e "$bgimage" ]; then
			hsetroot -solid "$bgcolor" -tile "$bgimage"
		else
			hsetroot -solid "$bgcolor"
		fi
	else
		xsetroot -solid "$bgcolor"
	fi

	if have compton; then
		compton &

		if [ -x /usr/lib/notify-osd/notify-osd ]; then
			/usr/lib/notify-osd/notify-osd &
		fi
	fi
fi

if have keyctl; then
	# set up session keyring (pam_keyinit does not work with GDM due to
	# thread issues, fixed in Linux commit 3a50597de)
	if [ "`keyctl rdescribe @s`" = "`keyctl rdescribe @us`" ]; then
		keyctl show -x
		echo "Creating new session keyring"
		if keyctl new_session > /dev/null; then
			keyctl link @u @s
			keyctl show -x
		fi
	fi
	# set up some pointers to environment (for use by cron)
	keyctl add user 'env:KRB5CCNAME' "$KRB5CCNAME" @u > /dev/null
fi

if have auca-seed; then
	auca-seed &
fi

if [ -f ~/.config/synclient.conf ]; then
	synclient `grep -v "^#" ~/.config/synclient.conf` &
fi

if [ $HOSTNAME = rain ]; then
	gnome-mpris-inhibit mpd --flags=suspend &
	mpris mpd notify-idle &
fi

true
