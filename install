#!/usr/bin/env bash
set -e

dir=~/lib/dotfiles
all=false
force=false

while getopts ad:f OPT; do
	case $OPT in
	a)	all=true;;
	d)	dir=$OPTARG;;
	f)	force=true;;
	esac
done

link() {
	local target="$dir/${1%/}" link=$2
	if [ -e "$link" ] && [ ! -h "$link" ] && ! $force; then
		echo "Not overwriting $link" >&2
	else
		rm -f "$link"
		sym -vf "$target" "$link"
	fi
}
hash sym || sym() { ~/code/sym.pl "$@"; }

mkdir -pm 0700 ~/.ssh
link	bashrc		~/.bashrc
link	gitconfig	~/.gitconfig
link	gitignore	~/.gitignore
link	profile		~/.profile
link	ssh-config	~/.ssh/config
link	vimrc		~/.vimrc
link	vim/		~/.vim
$all || exit 0

link	mailrc		~/.mailrc
link	muttrc		~/.muttrc
link	screenrc	~/.screenrc
link	tmux.conf	~/.tmux.conf
