#!bash
# ~/.makepkg.conf - makepkg.conf(5) - Arch makepkg configuration

# Package metadata

PACKAGER="$NAME <$EMAIL>"
PKGEXT=".pkg.tar.gz"
INTEGRITY_CHECK=(sha1)

# File locations

#PKGDEST=~/pkg/packages
#SRCPKGDEST=~/pkg/src-packages
SRCDEST=~/src/_makepkg

test "$PKGDEST"    && mkdir -p "$PKGDEST"
test "$SRCPKGDEST" && mkdir -p "$SRCPKGDEST"
test "$SRCDEST"    && mkdir -p "$SRCDEST"

# Build options

BUILDENV+=(ccache)
OPTIONS+=(!strip !zipman debug)

DEBUG_CFLAGS="-g -O1"
DEBUG_CXXFLAGS="-g -O1"

# Environment

unset PERL_MM_OPT
unset PERL_MB_OPT

export LINGUAS="en lt"

if [[ $0 == */makepkg && ! $_INHIBITED ]]; then
	_cmdl=()
	type -P schedtool > /dev/null &&
	_cmdl+=(schedtool -B -n 2 -e)
	type -P gnome-inhibit > /dev/null &&
	_cmdl+=(gnome-inhibit
		--always
		--who="makepkg"
		--what="suspend"
		--why="Building a package"
		--)
	type -P systemd-inhibit > /dev/null &&
	type -P systemd-notify  > /dev/null &&
	systemd-notify --booted &&
	_cmdl+=(systemd-inhibit
		--who="makepkg"
		--what="sleep"
		--why="Building a package"
		--)
	_cmdl+=(makepkg)
	for (( _i = ${#BASH_ARGV[@]}; _i > 1; _i )); do
		_cmdl+=("${BASH_ARGV[--_i]}")
	done
	_INHIBITED=1 exec "${_cmdl[@]}"
fi
